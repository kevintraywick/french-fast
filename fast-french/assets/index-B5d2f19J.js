(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=n(a);fetch(a.href,i)}})();const O=[{emoji:"ğŸ",french:"pomme",english:"apple"},{emoji:"ğŸŠ",french:"orange",english:"orange"},{emoji:"ğŸ‹",french:"citron",english:"lemon"},{emoji:"ğŸŒ",french:"banane",english:"banana"},{emoji:"ğŸ‡",french:"raisin",english:"grape"},{emoji:"ğŸ“",french:"fraise",english:"strawberry"},{emoji:"ğŸ’",french:"cerise",english:"cherry"},{emoji:"ğŸ‘",french:"pÃªche",english:"peach"},{emoji:"ğŸ",french:"poire",english:"pear"},{emoji:"ğŸ¥",french:"kiwi",english:"kiwi"},{emoji:"ğŸ…",french:"tomate",english:"tomato"},{emoji:"ğŸ¥•",french:"carotte",english:"carrot"},{emoji:"ğŸ§…",french:"oignon",english:"onion"},{emoji:"ğŸ¥’",french:"concombre",english:"cucumber"},{emoji:"ğŸ¥¬",french:"laitue",english:"lettuce"},{emoji:"ğŸ¥¦",french:"brocoli",english:"broccoli"},{emoji:"ğŸŒ½",french:"maÃ¯s",english:"corn"},{emoji:"ğŸ",french:"pain",english:"bread"},{emoji:"ğŸ¥",french:"croissant",english:"croissant"},{emoji:"ğŸ§€",french:"fromage",english:"cheese"},{emoji:"ğŸ¥š",french:"Å“uf",english:"egg"},{emoji:"ğŸ—",french:"poulet",english:"chicken"},{emoji:"ğŸ¥©",french:"viande",english:"meat"},{emoji:"ğŸŸ",french:"poisson",english:"fish"},{emoji:"ğŸ•",french:"pizza",english:"pizza"},{emoji:"ğŸ”",french:"hamburger",english:"hamburger"},{emoji:"ğŸŸ",french:"frites",english:"fries"},{emoji:"ğŸ°",french:"gÃ¢teau",english:"cake"},{emoji:"ğŸª",french:"biscuit",english:"cookie"},{emoji:"ğŸ«",french:"chocolat",english:"chocolate"},{emoji:"ğŸ¬",french:"bonbon",english:"candy"},{emoji:"ğŸ¦",french:"glace",english:"ice cream"},{emoji:"â˜•",french:"cafÃ©",english:"coffee"},{emoji:"ğŸµ",french:"thÃ©",english:"tea"},{emoji:"ğŸ¥›",french:"lait",english:"milk"},{emoji:"ğŸ·",french:"vin",english:"wine"},{emoji:"ğŸº",french:"biÃ¨re",english:"beer"},{emoji:"ğŸ’§",french:"eau",english:"water"},{emoji:"ğŸ¶",french:"chien",english:"dog"},{emoji:"ğŸ±",french:"chat",english:"cat"},{emoji:"ğŸ­",french:"souris",english:"mouse"},{emoji:"ğŸ°",french:"lapin",english:"rabbit"},{emoji:"ğŸ¦Š",french:"renard",english:"fox"},{emoji:"ğŸ»",french:"ours",english:"bear"},{emoji:"ğŸ¼",french:"panda",english:"panda"},{emoji:"ğŸ¦",french:"lion",english:"lion"},{emoji:"ğŸ¯",french:"tigre",english:"tiger"},{emoji:"ğŸ®",french:"vache",english:"cow"},{emoji:"ğŸ·",french:"cochon",english:"pig"},{emoji:"ğŸ¸",french:"grenouille",english:"frog"},{emoji:"ğŸµ",french:"singe",english:"monkey"},{emoji:"ğŸ”",french:"poule",english:"hen"},{emoji:"ğŸ§",french:"pingouin",english:"penguin"},{emoji:"ğŸ¦",french:"oiseau",english:"bird"},{emoji:"ğŸ¦†",french:"canard",english:"duck"},{emoji:"ğŸ¦…",french:"aigle",english:"eagle"},{emoji:"ğŸ¦‰",french:"hibou",english:"owl"},{emoji:"ğŸ´",french:"cheval",english:"horse"},{emoji:"ğŸ",french:"abeille",english:"bee"},{emoji:"ğŸ¦‹",french:"papillon",english:"butterfly"},{emoji:"ğŸŒ",french:"escargot",english:"snail"},{emoji:"ğŸ¢",french:"tortue",english:"turtle"},{emoji:"ğŸ",french:"serpent",english:"snake"},{emoji:"ğŸ¦ˆ",french:"requin",english:"shark"},{emoji:"ğŸ‹",french:"baleine",english:"whale"},{emoji:"ğŸ˜",french:"Ã©lÃ©phant",english:"elephant"},{emoji:"ğŸ¦’",french:"girafe",english:"giraffe"},{emoji:"ğŸ‘",french:"mouton",english:"sheep"},{emoji:"ğŸŒ¸",french:"fleur",english:"flower"},{emoji:"ğŸŒ¹",french:"rose",english:"rose"},{emoji:"ğŸŒ»",french:"tournesol",english:"sunflower"},{emoji:"ğŸŒ³",french:"arbre",english:"tree"},{emoji:"ğŸ€",french:"trÃ¨fle",english:"clover"},{emoji:"ğŸ",french:"feuille",english:"leaf"},{emoji:"ğŸŒŠ",french:"vague",english:"wave"},{emoji:"â›°ï¸",french:"montagne",english:"mountain"},{emoji:"ğŸŒˆ",french:"arc-en-ciel",english:"rainbow"},{emoji:"â­",french:"Ã©toile",english:"star"},{emoji:"ğŸŒ™",french:"lune",english:"moon"},{emoji:"â˜€ï¸",french:"soleil",english:"sun"},{emoji:"â˜ï¸",french:"nuage",english:"cloud"},{emoji:"ğŸŒ§ï¸",french:"pluie",english:"rain"},{emoji:"â„ï¸",french:"neige",english:"snow"},{emoji:"âš¡",french:"Ã©clair",english:"lightning"},{emoji:"ğŸ”¥",french:"feu",english:"fire"},{emoji:"ğŸ ",french:"maison",english:"house"},{emoji:"ğŸš—",french:"voiture",english:"car"},{emoji:"âœˆï¸",french:"avion",english:"airplane"},{emoji:"ğŸš‚",french:"train",english:"train"},{emoji:"ğŸš¢",french:"bateau",english:"boat"},{emoji:"ğŸš²",french:"vÃ©lo",english:"bicycle"},{emoji:"ğŸš",french:"hÃ©licoptÃ¨re",english:"helicopter"},{emoji:"ğŸš€",french:"fusÃ©e",english:"rocket"},{emoji:"âŒš",french:"montre",english:"watch"},{emoji:"ğŸ“±",french:"tÃ©lÃ©phone",english:"phone"},{emoji:"ğŸ’»",french:"ordinateur",english:"computer"},{emoji:"ğŸ“º",french:"tÃ©lÃ©vision",english:"television"},{emoji:"ğŸ”‘",french:"clÃ©",english:"key"},{emoji:"ğŸ’¡",french:"lampe",english:"lamp"},{emoji:"ğŸ“š",french:"livre",english:"book"},{emoji:"âœï¸",french:"crayon",english:"pencil"},{emoji:"âœ‚ï¸",french:"ciseaux",english:"scissors"},{emoji:"ğŸ’",french:"sac Ã  dos",english:"backpack"},{emoji:"ğŸ‘“",french:"lunettes",english:"glasses"},{emoji:"ğŸ‘’",french:"chapeau",english:"hat"},{emoji:"ğŸ‘Ÿ",french:"chaussure",english:"shoe"},{emoji:"ğŸ‘•",french:"chemise",english:"shirt"},{emoji:"ğŸ‘—",french:"robe",english:"dress"},{emoji:"â˜‚ï¸",french:"parapluie",english:"umbrella"},{emoji:"ğŸ’",french:"diamant",english:"diamond"},{emoji:"ğŸ””",french:"cloche",english:"bell"},{emoji:"ğŸ",french:"cadeau",english:"gift"},{emoji:"ğŸˆ",french:"ballon",english:"balloon"},{emoji:"ğŸ¨",french:"peinture",english:"painting"},{emoji:"ğŸµ",french:"musique",english:"music"},{emoji:"ğŸ¸",french:"guitare",english:"guitar"},{emoji:"ğŸ¹",french:"piano",english:"piano"},{emoji:"âš½",french:"football",english:"soccer"},{emoji:"ğŸ€",french:"basket",english:"basketball"},{emoji:"ğŸ‘¶",french:"bÃ©bÃ©",english:"baby"},{emoji:"ğŸ‘¦",french:"garÃ§on",english:"boy"},{emoji:"ğŸ‘§",french:"fille",english:"girl"},{emoji:"ğŸ‘¨",french:"homme",english:"man"},{emoji:"ğŸ‘©",french:"femme",english:"woman"},{emoji:"â¤ï¸",french:"cÅ“ur",english:"heart"},{emoji:"ğŸ‘‹",french:"main",english:"hand"},{emoji:"ğŸ‘ï¸",french:"Å“il",english:"eye"},{emoji:"ğŸ‘‚",french:"oreille",english:"ear"},{emoji:"ğŸ‘ƒ",french:"nez",english:"nose"},{emoji:"ğŸ‘„",french:"bouche",english:"mouth"},{emoji:"ğŸ«",french:"Ã©cole",english:"school"},{emoji:"ğŸ¥",french:"hÃ´pital",english:"hospital"},{emoji:"ğŸª",french:"magasin",english:"store"},{emoji:"ğŸ¨",french:"hÃ´tel",english:"hotel"},{emoji:"â›ª",french:"Ã©glise",english:"church"},{emoji:"ğŸ°",french:"chÃ¢teau",english:"castle"},{emoji:"ğŸŒ‰",french:"pont",english:"bridge"},{emoji:"ğŸ–ï¸",french:"plage",english:"beach"},{emoji:"0ï¸âƒ£",french:"zÃ©ro",english:"zero",tags:["number"],numeral:0},{emoji:"1ï¸âƒ£",french:"un",english:"one",tags:["number"],numeral:1},{emoji:"2ï¸âƒ£",french:"deux",english:"two",tags:["number"],numeral:2},{emoji:"3ï¸âƒ£",french:"trois",english:"three",tags:["number"],numeral:3},{emoji:"4ï¸âƒ£",french:"quatre",english:"four",tags:["number"],numeral:4},{emoji:"5ï¸âƒ£",french:"cinq",english:"five",tags:["number"],numeral:5},{emoji:"6ï¸âƒ£",french:"six",english:"six",tags:["number"],numeral:6},{emoji:"7ï¸âƒ£",french:"sept",english:"seven",tags:["number"],numeral:7},{emoji:"8ï¸âƒ£",french:"huit",english:"eight",tags:["number"],numeral:8},{emoji:"9ï¸âƒ£",french:"neuf",english:"nine",tags:["number"],numeral:9},{color:"#DC143C",french:"rouge",english:"red",tags:["color"]},{color:"#0055A4",french:"bleu",english:"blue",tags:["color"]},{color:"#FFD700",french:"jaune",english:"yellow",tags:["color"]},{color:"#2E8B57",french:"vert",english:"green",tags:["color"]},{color:"#FF8C00",french:"orange",english:"orange",tags:["color"]},{color:"#7B2D8E",french:"violet",english:"purple",tags:["color"]},{color:"#1A1A1A",french:"noir",english:"black",tags:["color"]},{color:"#F5F5F5",french:"blanc",english:"white",tags:["color"]},{color:"#808080",french:"gris",english:"gray",tags:["color"]},{color:"#FF69B4",french:"rose",english:"pink",tags:["color"]},{color:"#8B4513",french:"marron",english:"brown",tags:["color"]},{color:"#F5F0E1",french:"beige",english:"beige",tags:["color"]},{color:"#800020",french:"bordeaux",english:"burgundy",tags:["color"]},{color:"#B57EDC",french:"lavande",english:"lavender",tags:["color"]},{color:"#007FFF",french:"azur",english:"azure",tags:["color"]},{color:"#F7E7CE",french:"champagne",english:"champagne",tags:["color"]},{color:"#40E0D0",french:"turquoise",english:"turquoise",tags:["color"]},{color:"#000080",french:"bleu marine",english:"navy blue",tags:["color"]},{color:"#6B8E23",french:"vert olive",english:"olive green",tags:["color"]},{color:"#DAA520",french:"or",english:"gold",tags:["color"]},{color:"#C0C0C0",french:"argent",english:"silver",tags:["color"]},{color:"#FFFDD0",french:"crÃ¨me",english:"cream",tags:["color"]},{color:"#FFFFF0",french:"ivoire",english:"ivory",tags:["color"]},{color:"#FF7F50",french:"corail",english:"coral",tags:["color"]},{color:"#D2691E",french:"chocolat",english:"chocolate",tags:["color"]},{color:"rainbow",french:"couleur",english:"color",tags:["color"]}],De=[{emoji:"â˜•",french:"cafÃ©",english:"coffee"},{emoji:"ğŸµ",french:"thÃ©",english:"tea"},{emoji:"ğŸ¥›",french:"lait",english:"milk"},{emoji:"ğŸ’§",french:"eau",english:"water"},{emoji:"ğŸ¥¤",french:"jus",english:"juice"},{emoji:"ğŸ«",french:"chocolat",english:"chocolate"},{emoji:"ğŸ¥",french:"croissant",english:"croissant"},{emoji:"ğŸ¥–",french:"baguette",english:"baguette"},{emoji:"ğŸ§ˆ",french:"beurre",english:"butter"},{emoji:"ğŸ¯",french:"miel",english:"honey"},{emoji:"ğŸ«™",french:"confiture",english:"jam"},{emoji:"ğŸ°",french:"tarte",english:"tart"},{emoji:"ğŸ§‡",french:"gaufre",english:"waffle"},{emoji:"ğŸ¥",french:"crÃªpe",english:"crÃªpe"},{emoji:"ğŸ¥š",french:"Å“uf",english:"egg"},{emoji:"ğŸ§€",french:"fromage",english:"cheese"},{emoji:"ğŸ¥„",french:"cuillÃ¨re",english:"spoon"},{emoji:"ğŸ¥£",french:"bol",english:"bowl"},{emoji:"ğŸ½ï¸",french:"assiette",english:"plate"},{emoji:"ğŸª‘",french:"chaise",english:"chair"},{emoji:"ğŸ“‹",french:"menu",english:"menu"},{emoji:"ğŸ§¾",french:"addition",english:"bill"},{emoji:"ğŸ‘‹",french:"bonjour",english:"hello"},{emoji:"ğŸ™",french:"merci",english:"thanks"},{emoji:"ğŸ™‡",french:"pardon",english:"sorry"}],Pe=["","Un","Deux","Trois","Quatre","Cinq","Six","Sept","Huit","Neuf","Dix","Onze","Douze","Treize","Quatorze","Quinze","Seize","Dix-sept","Dix-huit","Dix-neuf","Vingt"];function T(o){return o<=3?String(o):o>=4&&o<=20?Pe[o]:String(o)}function ye(o){return(o||"").replace(/\uFE0F/g,"").trim()}function f(o){return(o||"").normalize("NFC").trim().toLowerCase()}const e={cards:[],selectedCard:null,paused:!1,velocityMultiplier:.2,playerId:null,learnedCount:0,totalWords:5e3,maxCards:50,roundBasePairs:25,roundIncrement:5,roundMaxPairs:50,roundChallenges:[],multiStep:null,matchedSteps:0,typingMode:!1,typingTarget:null,iconMode:!1,iconTarget:null,iconQueue:[],phraseMode:!1,colorMode:!1,shooterMode:!1,missiles:[],paddleX:0,paddleWord:null,paddleMoving:{left:!1,right:!1},bounceEmojis:[],emojiSpawnQueue:[],emojiSpawnTimer:null,totalEmojis:0,clearedEmojis:0,maxEmojis:50,breakoutScore:0,comboMode:!1,comboStreak:0,comboSlowUntil:0,shooterSlots:[],iconSpawnQueue:[],wordRefillQueue:[],roundTheme:"",currentRound:1,roundWords:[],matchedKeys:new Set,spawnInterval:null,activePairs:new Map,wordProgress:{}};function Fe(){return"player_"+Date.now().toString(36)+"_"+Math.random().toString(36).substr(2,9)}function Re(){const o="frenchfast_v20_playerId";let t=localStorage.getItem(o);return t?console.log("Returning player:",t):(t=Fe(),localStorage.setItem(o,t),console.log("New player created:",t)),t}let N=0,fe=0;const v=document.getElementById("game-area"),We=document.getElementById("progress-bar"),Se=document.getElementById("pause-btn"),ze=document.getElementById("skip-round-btn"),Ee=document.getElementById("pause-overlay"),Y=document.getElementById("voice-test-btn"),Ke=document.getElementById("matched-count"),Ne=document.getElementById("total-count"),J=document.getElementById("round-number"),he=document.getElementById("round-theme"),Me=document.getElementById("round-complete-overlay"),Ae=document.getElementById("round-complete-text"),Z=document.getElementById("round-time-value"),Le=document.getElementById("next-round-btn"),U=document.getElementById("validation-overlay"),ue=document.getElementById("validation-text"),ee=document.getElementById("validation-subtitle"),te=document.getElementById("validation-status"),ve=document.getElementById("audio-setup-overlay"),F=document.getElementById("round-title-overlay"),ne=document.getElementById("round-title-text"),oe=document.getElementById("round-title-instructions"),se=document.getElementById("center-icon-container"),B=document.getElementById("center-icon-circle"),re=document.getElementById("croissant-shooter");document.getElementById("croissant-ship");function $e(){Ve(),pe(),ve.classList.add("show"),Y.classList.add("flash-attention"),setTimeout(()=>{Y.classList.remove("flash-attention"),ve.classList.remove("show"),U.classList.add("show"),ue.textContent="Match the Pairs",ee.textContent="(Don't forget to enable audio and select a voice)",ee.style.display="block",te.textContent="";let t=!1;try{t=R()}catch(n){console.error("setupRound failed:",n),t=!1}if(!t)try{const n=O.filter(r=>!r.tags||!r.tags.includes("number")&&!r.tags.includes("color"));e.roundWords=n.slice(0,25).map(r=>({...r,key:f(r.french)})),e.roundChallenges=[],e.matchedKeys.clear(),e.matchedSteps=0,e.activePairs.clear(),J.textContent=T(e.currentRound||1),j(),t=!0}catch(n){console.error("fallback failed:",n),te.textContent="âœ— Fatal error starting game";return}setTimeout(()=>{U.classList.remove("show"),z(),K(),fe=performance.now(),requestAnimationFrame(Te),W()},3e3)},5e3),Se.addEventListener("click",de),ze.addEventListener("click",Qe),Ee.addEventListener("click",de),document.addEventListener("keydown",at),document.addEventListener("keyup",lt),v.addEventListener("click",t=>{const n=t.target.closest(".card");if(n){const r=parseInt(n.dataset.id);if(t.shiftKey){const a=e.cards.find(i=>i.id===r);if(a&&a.type==="word"){a.showEnglish=!a.showEnglish;const i=(a.wordData.english||"").trim();a.showEnglish&&i?a.element.textContent=i:a.element.textContent=a.wordData.french,a.element.style.fontStyle=a.showEnglish&&i?"italic":"normal";return}}ot(r)}}),q(),Y&&Y.addEventListener("click",()=>{ge=!0,q();try{if("speechSynthesis"in window){const t=_(),n=new SpeechSynthesisUtterance("Bonjour");n.lang="fr-FR",n.rate=.95,n.pitch=1,t&&(n.voice=t),window.speechSynthesis.cancel(),window.speechSynthesis.speak(n)}}catch{}}),Le.addEventListener("click",Oe);const o=document.getElementById("theme-toggle-btn");if(o){try{localStorage.getItem("frenchfast_theme")==="dark"&&(document.body.classList.add("dark-mode"),o.textContent="â˜€ï¸")}catch{}o.addEventListener("click",()=>{document.body.classList.toggle("dark-mode");const t=document.body.classList.contains("dark-mode");o.textContent=t?"â˜€ï¸":"ğŸŒ™";try{localStorage.setItem("frenchfast_theme",t?"dark":"light")}catch{}})}}function R(){_(),e.typingMode=!1,e.typingTarget=null,e.iconMode=!1,e.iconTarget=null,e.iconQueue=[],e.phraseMode=!1,e.colorMode=!1,e.comboMode=!1,e.shooterMode=!1,e.missiles=[],e.paddleWord=null,e.paddleMoving={left:!1,right:!1},e.roundTheme="",se.classList.remove("show"),re.classList.remove("show");const o=document.getElementById("paddle-container");o&&o.classList.remove("show");const t=document.getElementById("paddle-hint");t&&t.classList.remove("show");const n=document.getElementById("top-score");n&&(n.style.display="none");const r=document.getElementById("streak-counter");if(r&&(r.classList.remove("show","fire","blaze"),r.textContent=""),e.bounceEmojis)for(const d of e.bounceEmojis)d.element&&d.element.parentNode&&d.element.remove();if(e.bounceEmojis=[],e.emojiSpawnTimer&&(clearInterval(e.emojiSpawnTimer),e.emojiSpawnTimer=null),e.shooterSlots=[],e.iconSpawnQueue=[],e.wordRefillQueue=[],e.missiles)for(const d of e.missiles)d.element&&d.element.parentNode&&d.element.remove();if(e.missiles=[],e.currentRound===3||e.currentRound>=5){e.iconMode=!1,e.phraseMode=!1,e.colorMode=!1,e.shooterMode=!0,e.roundTheme="Breakout!",e.missiles=[],e.bounceEmojis=[],e.paddleMoving={left:!1,right:!1};const d=h=>{const b=f(h.french),L=e.wordProgress[b];return L&&L.learned},g=O.filter(h=>h.emoji&&!h.tags);let y=g.filter(h=>d(h)?Math.random()<.15:!0);y.length<20&&(y=[...g]),y=y.sort(()=>Math.random()-.5).slice(0,50),e.roundWords=y.map(h=>({...h,key:f(h.french)})),e.totalEmojis=e.roundWords.length,e.clearedEmojis=0,e.emojiSpawnQueue=[...e.roundWords].sort(()=>Math.random()-.5);const I=Math.min(10,e.emojiSpawnQueue.length);for(let h=0;h<I;h++)Ce(e.emojiSpawnQueue.shift());e.emojiSpawnTimer=setInterval(()=>{if(e.paused)return;if(e.emojiSpawnQueue.length===0){clearInterval(e.emojiSpawnTimer),e.emojiSpawnTimer=null;return}const h=e.bounceEmojis.filter($=>$.alive).length,b=25;if(h>=b)return;const L=Math.min(5,e.emojiSpawnQueue.length,b-h);for(let $=0;$<L;$++)Ce(e.emojiSpawnQueue.shift())},5e3),e.paddleWord=e.roundWords[0];const P=document.getElementById("paddle");P.textContent=e.paddleWord.french,e.paddleX=(v.offsetWidth-140)/2,P.style.left=e.paddleX+"px",console.log(`Round ${e.currentRound} - Breakout: ${e.roundWords.length} emojis`),e.roundChallenges=[],e.matchedKeys.clear(),e.matchedSteps=0,e.activePairs.clear(),e.multiStep=null,J.textContent=T(e.currentRound),he.textContent=` - ${e.roundTheme}`,j(),se.classList.remove("show"),re.classList.remove("show"),document.getElementById("paddle-container").classList.add("show"),document.getElementById("paddle-hint").classList.add("show"),e.breakoutScore=0;const M=document.getElementById("top-score");return M.textContent="0",M.style.color="#4CAF50",M.style.display="inline",e.comboStreak=0,document.getElementById("streak-counter").textContent="",document.getElementById("streak-counter").classList.add("show"),e.roundWords.length>0}if(e.currentRound===4){e.roundTheme="Au CafÃ©";const d=[...De],g=h=>{const b=f(h.french),L=e.wordProgress[b];return L&&L.learned};let y=d.filter(h=>g(h)?Math.random()<.1:!0);y.length<10&&(y=[...d]),y=y.sort(()=>Math.random()-.5);const I=new Set,P=new Set,M=[];for(const h of y){const b=ye(h.emoji),L=f(h.french);I.has(b)||P.has(L)||(I.add(b),P.add(L),M.push(h))}return e.roundWords=M.map(h=>({...h,key:f(h.french)})),e.roundChallenges=[],e.matchedKeys.clear(),e.matchedSteps=0,e.activePairs.clear(),e.multiStep=null,J.textContent=T(e.currentRound),he.textContent=` - ${e.roundTheme}`,j(),e.roundWords.length>0}const a=Math.min(e.roundBasePairs+(e.currentRound-1)*e.roundIncrement,e.roundMaxPairs),i=O.filter(d=>!d.tags||!d.tags.includes("number")&&!d.tags.includes("color")),s=O.filter(d=>d.tags&&d.tags.includes("number")),c=O.filter(d=>d.tags&&d.tags.includes("color"));let m=[...i,...s,...c.map(d=>({...d,itemType:"color"}))];const u=m.filter(d=>Xe(d.french)),w=[...(u.length>=a?u:m).filter(d=>(d.emoji||d.color)&&d.french)].sort(()=>Math.random()-.5),S=w.slice(0,Math.min(a*2,w.length)),x=new Set,E=new Set,C=[];for(const d of S){const g=d.emoji?ye(d.emoji):d.color||"",y=f(d.french);x.has(g)||E.has(y)||(x.add(g),E.add(y),C.push(d))}if(e.roundWords=C.slice(0,Math.min(a,C.length)),e.roundChallenges=[],e.roundWords=e.roundWords.map(d=>({...d,key:f(d.french)})),e.matchedKeys.clear(),e.matchedSteps=0,e.spawnedEmojiIndices=[],e.spawnedWordIndices=[],e.activePairs.clear(),e.multiStep=null,J.textContent=T(e.currentRound),he.textContent="",j(),e.roundWords.length===0){const d=O.filter(g=>!g.tags||!g.tags.includes("number")&&!g.tags.includes("color"));e.roundWords=d.slice(0,Math.min(25,d.length)).map(g=>({...g,key:f(g.french)})),e.roundChallenges=[]}return e.roundWords.length>0}function W(){let o=0;e.spawnInterval=setInterval(()=>{if(!e.paused){if(o<e.roundWords.length){if(e.typingMode)et(o);else if(e.colorMode)je(o),me(o);else if(e.iconMode)me(o);else if(e.phraseMode)Ge(o),Ze(o);else if(!e.shooterMode){const t=e.roundWords[o];t&&t.itemType==="color"?je(o):Je(o),me(o)}o++}if(o>=e.roundWords.length&&(clearInterval(e.spawnInterval),e.spawnInterval=null,!e.typingMode&&!e.iconMode&&!e.phraseMode&&!e.colorMode&&e.roundChallenges&&e.roundChallenges.length))for(let t=0;t<e.roundChallenges.length;t++)tt(t)}},e.typingMode?300:500)}function A(){const o=v.offsetWidth-100,t=v.offsetHeight-100,n=Math.floor(Math.random()*4);let r,a,i,s;switch(n){case 0:r=50+Math.random()*(o-50),a=-60,i=(Math.random()-.5)*.3,s=.1+Math.random()*.1;break;case 1:r=o+60,a=50+Math.random()*(t-100),i=-.1-Math.random()*.1,s=(Math.random()-.5)*.2;break;case 2:r=50+Math.random()*(o-50),a=t+60,i=(Math.random()-.5)*.3,s=-.1-Math.random()*.1;break;case 3:r=-60,a=50+Math.random()*(t-100),i=.1+Math.random()*.1,s=(Math.random()-.5)*.2;break}return{x:r,y:a,vx:i,vy:s}}function Oe(){e.spawnInterval&&(clearInterval(e.spawnInterval),e.spawnInterval=null);for(const n of e.cards)n.element.remove();e.cards=[];for(const n of e.missiles)n.element.remove();e.missiles=[],e.currentRound++,Me.classList.remove("show"),se.classList.remove("show"),re.classList.remove("show"),document.getElementById("paddle-container").classList.remove("show"),document.getElementById("paddle-hint").classList.remove("show"),document.getElementById("top-score").style.display="none",document.getElementById("streak-counter").classList.remove("show");const o=e.currentRound===4,t=e.currentRound===3||e.currentRound>=5;o?(F.classList.add("show"),ne.textContent=`Round ${T(e.currentRound)} - Au CafÃ©`,oe.textContent="Match cafÃ© items to their French names!",R(),setTimeout(()=>{F.classList.remove("show"),z(),K(),W()},3e3)):t?(F.classList.add("show"),ne.textContent=`Round ${T(e.currentRound)} - French CafÃ©`,oe.textContent="â† â†’ move paddle Â· Catch the matching emojis!",R(),setTimeout(()=>{F.classList.remove("show"),z(),K(),W()},3e3)):(U.classList.add("show"),ue.textContent="Match the Pairs",ee.style.display="none",te.textContent="",R(),setTimeout(()=>{U.classList.remove("show"),z(),K(),W()},3e3))}function Qe(){e.spawnInterval&&(clearInterval(e.spawnInterval),e.spawnInterval=null),Ie();for(const n of e.cards)n.element.remove();e.cards=[],e.selectedCard=null,e.typingTarget=null,e.iconTarget=null,e.multiStep=null;for(const n of e.missiles)n.element.remove();e.missiles=[],se.classList.remove("show"),re.classList.remove("show"),document.getElementById("paddle-container").classList.remove("show"),document.getElementById("paddle-hint").classList.remove("show"),document.getElementById("top-score").style.display="none",e.currentRound++;const o=e.currentRound===4,t=e.currentRound===3||e.currentRound>=5;o?(F.classList.add("show"),ne.textContent=`Round ${T(e.currentRound)} - Au CafÃ©`,oe.textContent="Match cafÃ© items to their French names!",R(),setTimeout(()=>{F.classList.remove("show"),z(),K(),W()},3e3)):t?(F.classList.add("show"),ne.textContent=`Round ${T(e.currentRound)} - French CafÃ©`,oe.textContent="â† â†’ move paddle Â· Catch the matching emojis!",R(),setTimeout(()=>{F.classList.remove("show"),z(),K(),W()},3e3)):(U.classList.add("show"),ue.textContent="Match the Pairs",ee.style.display="none",te.textContent="",R(),setTimeout(()=>{U.classList.remove("show"),z(),K(),W()},3e3))}const ie=document.getElementById("timer-value");let G=null,Q=null,ae=0;function le(o){const t=Math.floor(o/100),n=t%10,r=Math.floor(t/10),a=r%60,i=Math.floor(r/60),s=String(i).padStart(2,"0"),c=String(a).padStart(2,"0");return`${s}:${c}.${n}`}function z(){ae=0,G=performance.now(),ie&&(ie.textContent=le(0)),Z&&(Z.textContent=le(0))}function K(){Q&&clearInterval(Q),G=performance.now(),Q=setInterval(()=>{if(e.paused)return;const o=performance.now();ae+=o-G,G=o,ie&&(ie.textContent=le(ae))},100)}function Ie(){Q&&(clearInterval(Q),Q=null)}let ge=!0,we=[];function qe(o){const t=(o.lang||"").toLowerCase(),n=(o.name||"").toLowerCase();let r=0;return t==="fr-fr"&&(r+=1e3),t.startsWith("fr")&&(r+=800),n.includes("premium")&&(r+=200),n.includes("enhanced")&&(r+=150),n.includes("neural")&&(r+=120),t.startsWith("fr")||(r-=500),r}function Ue(){return!("speechSynthesis"in window)||!window.speechSynthesis.getVoices?[]:window.speechSynthesis.getVoices()||[]}function He(o){let t=null,n=-1e9;for(const r of o){const a=qe(r);a>n&&(n=a,t=r)}return t}function _(){const o=we.length?we:Ue(),t=o.filter(s=>(s.lang||"").toLowerCase().startsWith("fr")),n=e.currentRound%2===1,r=n?"amelie":"thomas",a=n?"thomas":"amelie";let i=t.find(s=>(s.name||"").toLowerCase().includes(r));return i||(i=t.find(s=>(s.name||"").toLowerCase().includes(a))),i||(i=He(o)),i||(i=o[0]||null),i}function q(){"speechSynthesis"in window&&_()}"speechSynthesis"in window&&(window.speechSynthesis.onvoiceschanged=()=>{q()},setTimeout(q,250),setTimeout(q,1500));function D(o){try{if(!ge){return}if(!("speechSynthesis"in window)||!("SpeechSynthesisUtterance"in window))return;q();const t=_();if(!t)return;const n=new SpeechSynthesisUtterance(o);n.lang="fr-FR",n.rate=.95,n.pitch=1,n.voice=t,(window.speechSynthesis.speaking||window.speechSynthesis.pending)&&window.speechSynthesis.cancel(),window.speechSynthesis.speak(n)}catch(t){console.warn("Speech synthesis failed:",t)}}function Ve(){e.playerId=Re();const o=localStorage.getItem("frenchfast_v20_progress");if(e.wordProgress={},e.learnedCount=0,o)try{const t=JSON.parse(o);t.playerId===e.playerId?e.wordProgress=t.wordProgress||{}:console.log("Progress data is for different player, starting fresh")}catch(t){console.warn("Progress parse failed:",t)}for(const t of Object.keys(e.wordProgress)){const n=e.wordProgress[t];n&&n.learned&&(e.learnedCount+=1)}console.log(`Loaded progress: ${e.learnedCount} words learned, ${Object.keys(e.wordProgress).length} words tracked`)}function ke(){localStorage.setItem("frenchfast_v20_progress",JSON.stringify({playerId:e.playerId,wordProgress:e.wordProgress,lastSaved:Date.now()}))}function pe(){const o=e.learnedCount/e.totalWords*100;We.style.height=o+"%"}function X(o){const t=f(o);e.wordProgress[t]||(e.wordProgress[t]={timesCorrect:0,learned:!1,lastSeen:0,display:o});const n=e.wordProgress[t];n.display=o,n.timesCorrect+=1,n.lastSeen=Date.now(),!n.learned&&n.timesCorrect>=3&&(n.learned=!0,e.learnedCount+=1,console.log(`Word learned: ${o} (${e.learnedCount} total)`)),ke(),pe()}function Xe(o){const t=f(o),n=e.wordProgress[t];return!n||!n.learned?!0:Math.random()<.1}function j(){const o=e.roundWords.length,t=e.roundChallenges?e.roundChallenges.length:0,n=e.typingMode||e.iconMode||e.colorMode||e.comboMode||e.shooterMode?o:o+t*2;Ke.textContent=e.matchedSteps,Ne.textContent=n}function _e(){if(e.iconMode){if(e.iconQueue.length===0){e.iconTarget=null,B.textContent="âœ“";return}e.iconTarget=e.iconQueue.shift(),B.textContent=e.iconTarget.emoji,B.classList.remove("correct","incorrect")}}function Ye(o){if(!e.iconMode||!e.iconTarget||o.type!=="word")return!1;const t=f(e.iconTarget.french);if(f(o.wordData.french)===t)return D(o.wordData.french),B.classList.add("correct"),o.element.classList.add("correct"),e.matchedKeys.add(o.pairKey),e.matchedSteps+=1,j(),X(o.wordData.french),setTimeout(()=>{k(o),_e(),H()},500),!0;{B.classList.add("incorrect"),o.element.classList.add("incorrect");const r=B.textContent;return B.textContent=e.iconTarget.french,setTimeout(()=>{B.classList.remove("incorrect"),o.element.classList.remove("incorrect"),B.textContent=r},800),!0}}function Je(o){const t=e.roundWords[o];if(!t){console.error(`No wordData at index ${o}`);return}const n=t.key;if(e.matchedKeys.has(n))return;const r=e.activePairs.get(n);if(r&&r.emoji)return;const a=N++,i=A(),s={id:a,type:"emoji",wordData:t,pairIndex:o,pairKey:n,x:i.x,y:i.y,vx:i.vx,vy:i.vy,width:58,height:58,frozen:!1,element:null},c=document.createElement("div");c.className="card emoji-card",c.dataset.id=a,c.dataset.pairKey=n,c.textContent=t.emoji,c.style.left=i.x+"px",c.style.top=i.y+"px",v.appendChild(c),s.element=c,e.cards.push(s),e.activePairs.has(n)?(e.activePairs.get(n).emoji=s,e.activePairs.get(n).pairIndex=o):e.activePairs.set(n,{emoji:s,word:null,spawnTime:Date.now(),pairIndex:o})}function me(o){const t=e.roundWords[o];if(!t){console.error(`No wordData at index ${o}`);return}const n=t.key;if(e.matchedKeys.has(n))return;const r=e.activePairs.get(n);if(r&&r.word)return;const a=N++,i=A(),s={id:a,type:"word",wordData:t,pairIndex:o,pairKey:n,x:i.x,y:i.y,vx:i.vx,vy:i.vy,width:0,height:0,frozen:!1,element:null},c=document.createElement("div");c.className="card word-card",c.dataset.id=a,c.dataset.pairKey=n,c.textContent=t.french,c.style.left=i.x+"px",c.style.top=i.y+"px",v.appendChild(c),s.element=c,s.width=c.offsetWidth,s.height=c.offsetHeight,e.cards.push(s),e.activePairs.has(n)?(e.activePairs.get(n).word=s,e.activePairs.get(n).pairIndex=o):e.activePairs.set(n,{emoji:null,word:s,spawnTime:Date.now(),pairIndex:o}),j()}function Ge(o){const t=e.roundWords[o];if(!t){console.error(`No wordData at index ${o}`);return}const n=t.key;if(e.matchedKeys.has(n))return;const r=e.activePairs.get(n);if(r&&r.french)return;const a=N++,i=A(),s={id:a,type:"french",wordData:t,pairIndex:o,pairKey:n,x:i.x,y:i.y,vx:i.vx,vy:i.vy,width:0,height:0,frozen:!1,element:null},c=document.createElement("div");c.className="card french-card",c.dataset.id=a,c.dataset.pairKey=n,c.textContent=t.french,c.style.left=i.x+"px",c.style.top=i.y+"px",v.appendChild(c),s.element=c,s.width=c.offsetWidth,s.height=c.offsetHeight,e.cards.push(s),e.activePairs.has(n)?(e.activePairs.get(n).french=s,e.activePairs.get(n).pairIndex=o):e.activePairs.set(n,{french:s,english:null,spawnTime:Date.now(),pairIndex:o}),j()}function Ze(o){const t=e.roundWords[o];if(!t){console.error(`No wordData at index ${o}`);return}const n=t.key;if(e.matchedKeys.has(n))return;const r=e.activePairs.get(n);if(r&&r.english)return;const a=N++,i=A(),s={id:a,type:"english",wordData:t,pairIndex:o,pairKey:n,x:i.x,y:i.y,vx:i.vx,vy:i.vy,width:0,height:0,frozen:!1,element:null},c=document.createElement("div");c.className="card english-card",c.dataset.id=a,c.dataset.pairKey=n,c.textContent=t.english,c.style.left=i.x+"px",c.style.top=i.y+"px",v.appendChild(c),s.element=c,s.width=c.offsetWidth,s.height=c.offsetHeight,e.cards.push(s),e.activePairs.has(n)?(e.activePairs.get(n).english=s,e.activePairs.get(n).pairIndex=o):e.activePairs.set(n,{french:null,english:s,spawnTime:Date.now(),pairIndex:o}),j()}function et(o){const t=e.roundWords[o];if(!t){console.error(`No wordData at index ${o}`);return}const n=t.key;if(e.matchedKeys.has(n))return;const r=N++,a=A(),i={id:r,type:"typing",wordData:t,pairIndex:o,pairKey:n,x:a.x,y:a.y,vx:a.vx,vy:a.vy,width:0,height:0,frozen:!1,element:null},s=document.createElement("div");s.className="card word-card typing-card",s.dataset.id=r,s.dataset.pairKey=n,s.dataset.numeral=t.numeral,s.textContent=t.french;const c=["#DC143C","#0055A4","#FFD700","#2E8B57","#FF8C00","#7B2D8E","#FF69B4","#40E0D0","#D2691E","#007FFF","#800020","#B57EDC","#FF7F50","#DAA520","#6B8E23"],m=c[o%c.length];s.style.background=`radial-gradient(ellipse at 30% 30%, ${m}cc, ${m})`,s.style.left=a.x+"px",s.style.top=a.y+"px",v.appendChild(s),i.element=s,i.width=s.offsetWidth,i.height=s.offsetHeight,e.cards.push(i),j()}function je(o){const t=e.roundWords[o];if(!t){console.error(`No wordData at index ${o}`);return}const n=t.key;if(e.matchedKeys.has(n))return;const r=e.activePairs.get(n);if(r&&r.emoji)return;const a=N++,i=A(),s={id:a,type:"emoji",wordData:t,pairIndex:o,pairKey:n,x:i.x,y:i.y,vx:i.vx,vy:i.vy,width:72,height:72,frozen:!1,element:null},c=document.createElement("div");if(c.className="card color-disc",c.dataset.id=a,c.dataset.pairKey=n,t.color==="rainbow")c.style.background="conic-gradient(from 0deg, #ff0000, #ff8800, #ffff00, #00cc00, #0066ff, #8800ff, #ff0000)",c.style.borderColor="rgba(0,0,0,0.2)";else{c.style.backgroundColor=t.color||"#888";const m=t.color||"#888",u=parseInt(m.slice(1,3),16),l=parseInt(m.slice(3,5),16),p=parseInt(m.slice(5,7),16);(u*299+l*587+p*114)/1e3>200&&(c.style.borderColor="rgba(0,0,0,0.35)")}c.style.left=i.x+"px",c.style.top=i.y+"px",v.appendChild(c),s.element=c,e.cards.push(s),e.activePairs.has(n)?(e.activePairs.get(n).emoji=s,e.activePairs.get(n).pairIndex=o):e.activePairs.set(n,{emoji:s,word:null,spawnTime:Date.now(),pairIndex:o})}function tt(o){const t=e.roundChallenges[o];if(!t)return;const n=N++,r=A(),a={id:n,type:"quantity",challengeIndex:o,wordData:t,x:r.x,y:r.y,vx:r.vx,vy:r.vy,width:70,height:58,frozen:!1,element:null},i=document.createElement("div");i.className="card emoji-card",i.dataset.id=n,i.textContent=t.emoji,i.style.left=r.x+"px",i.style.top=r.y+"px",v.appendChild(i),a.element=i,e.cards.push(a)}function Te(o){const t=(o-fe)/16.67;fe=o,e.paused||(nt(t),e.shooterMode&&dt(t)),requestAnimationFrame(Te)}function nt(o){const t=v.offsetWidth-60,n=v.offsetHeight,r=75,a=t/2,i=n/2;for(const s of e.cards){if(s.frozen)continue;if(s.x+=s.vx*o*e.velocityMultiplier,s.y+=s.vy*o*e.velocityMultiplier,s.vy+=.008*o*e.velocityMultiplier,e.shooterMode){const m=s.x+s.width/2,u=s.y+s.height/2,l=m-a,p=u-i,w=Math.sqrt(l*l+p*p),S=120;if(w<S&&w>0){const x=.05*(S-w)/S;s.vx+=l/w*x,s.vy+=p/w*x}}const c=80;s.x<c&&(s.vx+=.02*(c-s.x)/c),s.x+s.width>t-c&&(s.vx-=.02*(s.x+s.width-(t-c))/c),s.y>n-c-s.height&&(s.vy-=.01),s.vx*=.99,s.vy*=.995,s.x<10&&(s.x=10,s.vx=Math.abs(s.vx)*.4+.1),s.x+s.width>t&&(s.x=t-s.width,s.vx=-Math.abs(s.vx)*.4-.1),s.y+s.height>n-10&&(s.y=n-s.height-10,s.vy=-Math.abs(s.vy)*.3-.05,s.vx+=(Math.random()-.5)*.2),s.y<10&&(s.y=10,s.vy=Math.abs(s.vy)*.2)}for(let s=0;s<e.cards.length;s++)for(let c=s+1;c<e.cards.length;c++){const m=e.cards[s],u=e.cards[c],l=u.x+u.width/2-(m.x+m.width/2),p=u.y+u.height/2-(m.y+m.height/2),w=Math.hypot(l,p);if(w<r&&w>0){const S=r-w,x=l/w,E=p/w,C=.4;if(m.frozen||(m.x-=x*S*C,m.y-=E*S*C),u.frozen||(u.x+=x*S*C,u.y+=E*S*C),!m.frozen&&!u.frozen){const d=m.vx-u.vx,g=m.vy-u.vy;m.vx-=x*d*.15,m.vy-=E*g*.15,u.vx+=x*d*.15,u.vy+=E*g*.15}}}for(const s of e.cards)s.element.style.left=s.x+"px",s.element.style.top=s.y+"px"}function ot(o){const t=e.cards.find(n=>n.id===o);if(t){if(e.typingMode){if(t.type==="typing"){if(e.typingTarget&&e.typingTarget.id===o){e.typingTarget.frozen=!1,e.typingTarget.element.classList.remove("selected"),e.typingTarget=null,e.selectedCard=null;return}e.typingTarget&&(e.typingTarget.frozen=!1,e.typingTarget.element.classList.remove("selected")),t.frozen=!0,t.element.classList.add("selected"),e.typingTarget=t,e.selectedCard=t}return}if(!(e.iconMode&&Ye(t))){if(e.phraseMode){if(t.type==="french"){if(e.selectedCard&&e.selectedCard.id===o){e.selectedCard.frozen=!1,e.selectedCard.element.classList.remove("selected"),e.selectedCard=null;return}e.selectedCard&&(e.selectedCard.frozen=!1,e.selectedCard.element.classList.remove("selected")),t.frozen=!0,t.element.classList.add("selected"),e.selectedCard=t,D(t.wordData.french);return}if(t.type==="english"){if(!e.selectedCard||e.selectedCard.type!=="french"){D(t.wordData.french);return}if(t.pairKey===e.selectedCard.pairKey){D(t.wordData.french);const n=e.selectedCard;n.element.classList.remove("selected"),n.element.classList.add("correct"),t.element.classList.add("correct"),setTimeout(()=>{k(n),k(t)},500),e.matchedKeys.add(t.pairKey),e.matchedSteps+=1,j(),X(t.wordData.french),ce(!0,t.wordData),e.selectedCard=null,H()}else ce(!1),t.element.classList.add("incorrect"),e.selectedCard.element.classList.add("incorrect"),setTimeout(()=>{t.element.classList.remove("incorrect"),e.selectedCard&&e.selectedCard.element.classList.remove("incorrect")},400);return}return}if(t.type==="quantity"){if(e.selectedCard&&e.selectedCard.id===o){e.selectedCard.frozen=!1,e.selectedCard.element.classList.remove("selected"),e.selectedCard=null,e.multiStep=null;return}e.selectedCard&&(e.selectedCard.frozen=!1,e.selectedCard.element.classList.remove("selected")),e.selectedCard=t,t.frozen=!0,t.element.classList.add("selected"),e.multiStep={cardId:t.id,step:0};return}if(e.multiStep&&e.selectedCard){const n=e.cards.find(r=>r.id===e.multiStep.cardId);if(!n)e.multiStep=null;else{if(t.type!=="word")return;const r=e.multiStep.step===0?f(n.wordData.numberFrench):f(n.wordData.french);if(f(t.wordData.french)===r)D(t.wordData.french),t.element.classList.remove("selected"),t.element.classList.add("correct"),setTimeout(()=>k(t),600),e.matchedSteps+=1,j(),e.multiStep.step+=1,e.multiStep.step>=2?(n.element.classList.remove("selected"),n.element.classList.add("correct"),setTimeout(()=>k(n),600),e.matchedKeys.add(f(n.wordData.french)),e.selectedCard=null,e.multiStep=null,X(n.wordData.french),H()):n.element.textContent=`âœ“ ${n.wordData.numberFrench} â€” now pick the noun`;else{n.element.classList.add("incorrect"),setTimeout(()=>n.element.classList.remove("incorrect"),450);const a=n.element.textContent;n.element.textContent=e.multiStep.step===0?n.wordData.numberFrench:n.wordData.french,n.element.classList.add("show-word"),setTimeout(()=>{n.element.textContent=a,n.element.classList.remove("show-word")},900)}return}}if(e.selectedCard===null)e.selectedCard=t,t.frozen=!0,t.element.classList.add("selected");else if(e.selectedCard.id===o)e.selectedCard.frozen=!1,e.selectedCard.element.classList.remove("selected"),e.selectedCard=null;else{const n=e.selectedCard,r=t;if(n.type===r.type){n.frozen=!1,n.element.classList.remove("selected"),e.selectedCard=r,r.frozen=!0,r.element.classList.add("selected");return}r.frozen=!0,r.element.classList.add("selected"),f(n.wordData.french)===f(r.wordData.french)?st(n,r):it(n,r)}}}}function st(o,t){const n=o.pairKey||t.pairKey||f(o.wordData?.french||t.wordData?.french),r=o.wordData?.french||t.wordData?.french||n;e.wordProgress[n]||(e.wordProgress[n]={correctTotal:0,learned:!1,lastCorrect:0,display:r});const a=e.wordProgress[n];a.display=r,a.correctTotal+=1,a.lastCorrect=Date.now(),!a.learned&&a.correctTotal>=3&&(a.learned=!0,e.learnedCount+=1),ke(),pe(),D(r),e.matchedKeys.add(n),e.matchedSteps+=1,j(),o.element.classList.remove("selected"),t.element.classList.remove("selected"),o.element.classList.add("correct"),t.element.classList.add("correct");const i=e.activePairs.get(n);e.activePairs.delete(n),setTimeout(()=>{k(o),k(t),i&&(i.emoji&&i.emoji.id!==o.id&&i.emoji.id!==t.id&&k(i.emoji),i.word&&i.word.id!==o.id&&i.word.id!==t.id&&k(i.word)),j(),H()},600),e.selectedCard=null}function H(){const o=e.roundWords.length,t=e.roundChallenges?e.roundChallenges.length:0,n=e.typingMode||e.colorMode||e.comboMode||e.shooterMode?o:o+t*2;e.matchedSteps>=n&&(e.spawnInterval&&(clearInterval(e.spawnInterval),e.spawnInterval=null),e.emojiSpawnTimer&&(clearInterval(e.emojiSpawnTimer),e.emojiSpawnTimer=null),Ae.textContent=`ROUND ${T(e.currentRound).toUpperCase()} COMPLETE`,Le.textContent=`Start Round ${T(e.currentRound+1)}`,Ie(),Z&&(Z.textContent=le(ae)),rt(),Me.classList.add("show"))}function rt(){const o=[{text:"FÃ©licitations!",lang:"fr-FR"},{text:"Excellent travail!",lang:"fr-FR"},{text:"Bravo!",lang:"fr-FR"},{text:"TrÃ¨s bien!",lang:"fr-FR"},{text:"Magnifique!",lang:"fr-FR"}],t=o[Math.floor(Math.random()*o.length)];if(!(!ge||!("speechSynthesis"in window)))try{const n=_(),r=new SpeechSynthesisUtterance(t.text);r.lang=t.lang,r.rate=.9,r.pitch=1.1,n&&(r.voice=n),(window.speechSynthesis.speaking||window.speechSynthesis.pending)&&window.speechSynthesis.cancel(),window.speechSynthesis.speak(r)}catch(n){console.warn("Congratulations speech failed:",n)}}function it(o,t){o.element.classList.add("incorrect"),t.element.classList.add("incorrect");const n=o.type==="emoji"?o:t,r=n.element.textContent;n.element.textContent=n.wordData.french,n.element.classList.add("show-word"),setTimeout(()=>{o.element.classList.remove("selected","incorrect"),t.element.classList.remove("selected","incorrect"),n.element.textContent=r,n.element.classList.remove("show-word"),o.frozen=!1,t.frozen=!1},1e3),e.selectedCard=null}function k(o){const t=e.cards.findIndex(n=>n.id===o.id);t!==-1&&e.cards.splice(t,1),o.element.parentNode&&o.element.remove(),j()}function at(o){if(e.shooterMode&&!e.paused){if(o.key==="ArrowLeft"){o.preventDefault(),e.paddleMoving.left=!0;return}else if(o.key==="ArrowRight"){o.preventDefault(),e.paddleMoving.right=!0;return}else if(o.key===" "){o.preventDefault(),Be();return}}if(o.key==="p")o.preventDefault(),de();else if(o.key===" "&&!e.shooterMode)o.preventDefault(),de();else if(o.key==="Escape")e.selectedCard&&(e.selectedCard.frozen=!1,e.selectedCard.element.classList.remove("selected"),e.selectedCard=null),e.typingTarget=null;else if(e.typingMode&&e.typingTarget){const t=parseInt(o.key);!isNaN(t)&&t>=0&&t<=9&&(o.preventDefault(),ht(t))}}function lt(o){e.shooterMode&&(o.key==="ArrowLeft"&&(e.paddleMoving.left=!1),o.key==="ArrowRight"&&(e.paddleMoving.right=!1))}const xe=["#DC143C","#0055A4","#FFD700","#2E8B57","#FF8C00","#7B2D8E","#FF69B4","#8B4513","#00CED1","#6B8E23","#C0392B","#2980B9","#F39C12","#27AE60","#8E44AD","#E74C3C","#3498DB","#E67E22","#1ABC9C","#9B59B6"];let ct=0;function Ce(o){if(!o)return;const t=v.offsetWidth,n=58,r=document.createElement("div");r.className="bounce-emoji",r.textContent=o.emoji||"â“",r.style.width=n+"px",r.style.height=n+"px",r.style.fontSize=n*.55+"px";const a=xe[ct++%xe.length];r.style.background=`radial-gradient(circle at 35% 35%, ${a}88, ${a}cc)`;const i=20+Math.random()*(t-n-40),s=-n-Math.random()*80;r.style.left=i+"px",r.style.top=s+"px",v.appendChild(r);const c=Math.PI*.15+Math.random()*(Math.PI*.7),m=2.437+Math.random()*2.031;e.bounceEmojis.push({wordData:o,x:i,y:s,vx:Math.cos(c)*m*(Math.random()<.5?1:-1),vy:Math.abs(Math.sin(c))*m*.95,size:n,element:r,alive:!0,growScale:1,bgColor:a,boostUntil:0,paddleImmuneUntil:0})}function dt(o){const t=v.offsetWidth,n=v.offsetHeight,r=140,a=42,i=n-a-12,s=document.getElementById("paddle"),c=8*o;e.paddleMoving.left&&(e.paddleX-=c),e.paddleMoving.right&&(e.paddleX+=c),e.paddleX=Math.max(0,Math.min(t-r,e.paddleX)),s.style.left=e.paddleX+"px";const m=e.paddleX+r/2;for(let u=e.bounceEmojis.length-1;u>=0;u--){const l=e.bounceEmojis[u];if(!l.alive)continue;const p=l.size;l.x+=l.vx*o,l.y+=l.vy*o;const w=performance.now(),S=l.boostUntil>w;l.x<=0&&(l.x=0,l.vx=Math.abs(l.vx)*1),l.x+p>=t&&(l.x=t-p,l.vx=-Math.abs(l.vx)*1),l.y<=0&&(l.y=0,l.vy=Math.abs(l.vy)*1),l.y>n+p&&(l.y=-p,l.x=20+Math.random()*(t-p-40)),S&&(l.x+=l.vx*o*.5,l.y+=l.vy*o*.5);const x=l.x+p/2;if(l.vy>0&&(!l.paddleImmuneUntil||performance.now()>l.paddleImmuneUntil)&&l.y+p>=i&&l.y+p<=i+a+8&&x>=e.paddleX-5&&x<=e.paddleX+r+5){l.vy=-Math.abs(l.vy),l.y=i-p;const C=(x-m)/(r/2);if(l.vx+=C*2.5,l.boostUntil=performance.now()+2e3,e.paddleWord&&f(l.wordData.french)===f(e.paddleWord.french)){D(l.wordData.french),X(l.wordData.french),l.alive=!1,l.element.classList.add("popping"),setTimeout(()=>{l.element.parentNode&&l.element.remove()},550);const d=document.createElement("div");d.className="pop-ring",d.style.left=l.x+l.size/2+"px",d.style.top=l.y+l.size/2+"px",v.appendChild(d),setTimeout(()=>{d.parentNode&&d.remove()},600),s.classList.add("catching"),setTimeout(()=>s.classList.remove("catching"),400),ce(!0,l.wordData),e.matchedKeys.add(f(l.wordData.french)),e.clearedEmojis++,e.matchedSteps=e.clearedEmojis,j(),Be(),document.getElementById("paddle-hint").classList.remove("show"),e.bounceEmojis.splice(u,1),H();continue}else D(l.wordData.french),l.vx*=1.1,l.vy*=1.1,s.classList.add("missing"),setTimeout(()=>s.classList.remove("missing"),350),ce(!1)}for(let C=u-1;C>=0;C--){const d=e.bounceEmojis[C];if(!d.alive)continue;const g=l.x+l.size/2-(d.x+d.size/2),y=l.y+l.size/2-(d.y+d.size/2),I=Math.sqrt(g*g+y*y),P=(l.size+d.size)/2;if(I<P&&I>0){const M=g/I,h=y/I,b=P-I;l.x+=M*b*.5,l.y+=h*b*.5,d.x-=M*b*.5,d.y-=h*b*.5;const L=l.vx-d.vx,$=l.vy-d.vy,V=L*M+$*h;V>0&&(l.vx-=V*M*.875,l.vy-=V*h*.875,d.vx+=V*M*.875,d.vy+=V*h*.875)}}const E=12;l.vx=Math.max(-E,Math.min(E,l.vx)),l.vy=Math.max(-E,Math.min(E,l.vy)),l.element.style.left=l.x+"px",l.element.style.top=l.y+"px"}}function be(o){e.breakoutScore+=o;const t=document.getElementById("top-score");t.textContent=e.breakoutScore,e.breakoutScore<0?t.style.color="#F44336":t.style.color="#4CAF50"}function ce(o,t){if(!(!e.comboMode&&!e.shooterMode))if(o){e.comboStreak++,be(e.comboStreak>=5?6:3);const n=document.getElementById("streak-counter");if(e.comboStreak>=3?(n.textContent=`ğŸ”¥ ${e.comboStreak}x`,n.className=e.comboStreak>=5?"blaze show":"fire show"):n.textContent="",t&&t.itemType==="color"&&t.color){const r=document.getElementById("color-flash");r.style.background=`radial-gradient(circle, ${t.color}44, ${t.color}22, transparent)`,r.classList.remove("flash","rainbow"),r.offsetWidth,r.classList.add("flash"),setTimeout(()=>r.classList.remove("flash"),650)}if(e.comboStreak===5||e.comboStreak===10){const r=document.getElementById("color-flash");r.classList.remove("flash","rainbow"),r.offsetWidth,r.classList.add("rainbow"),setTimeout(()=>r.classList.remove("rainbow"),1300)}}else{e.comboStreak=0,be(-1);const n=document.getElementById("streak-counter");n.textContent="",n.className=""}}function Be(){const o=document.getElementById("paddle"),t=e.bounceEmojis.filter(i=>i.alive).map(i=>f(i.wordData.french)),r=[...new Set(t)].filter(i=>!e.matchedKeys.has(i));if(r.length>0){const i=r[Math.floor(Math.random()*r.length)],s=e.bounceEmojis.find(c=>c.alive&&f(c.wordData.french)===i)?.wordData;if(s){e.paddleWord=s,o.textContent=s.french;return}}const a=e.roundWords.filter(i=>!e.matchedKeys.has(f(i.french)));a.length>0?(e.paddleWord=a[Math.floor(Math.random()*a.length)],o.textContent=e.paddleWord.french):(e.paddleWord=null,o.textContent="âœ“")}function ht(o){if(!e.typingTarget)return;const t=e.typingTarget,n=t.wordData.numeral;if(o===n)D(t.wordData.french),t.element.classList.remove("selected"),t.element.classList.add("correct"),t.element.textContent=`${n}`,t.element.classList.add("show-word"),e.matchedKeys.add(t.pairKey),e.matchedSteps+=1,j(),X(t.wordData.french),setTimeout(()=>{k(t),H()},800),e.typingTarget=null,e.selectedCard=null;else{t.element.classList.add("incorrect");const r=t.element.textContent;t.element.textContent=`${n}`,t.element.classList.add("show-word"),setTimeout(()=>{t.element.classList.remove("incorrect","show-word"),t.element.textContent=r,t.frozen=!1,t.element.classList.remove("selected"),e.typingTarget=null,e.selectedCard=null},1e3)}}function de(){e.paused=!e.paused,Ee.classList.toggle("show",e.paused),Se.textContent=e.paused?"Resume":"Pause"}window.addEventListener("load",$e);
